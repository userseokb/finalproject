<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
 <mapper namespace="com.team2.finalproject.mapper.SearchMapper">
 	 	<select id="getProductBySearchQuery"
 	 	resultType="com.team2.finalproject.dto.product.ProductDto">
		SELECT product_code, category_code, name, content, price, stock, rdate 
		FROM product 
		WHERE name LIKE '%'||#{query}||'%'
 	 	</select>
 	 	
	 	 	<!-- getNoticeByPagination -->
		<select id="getSearchProductByPagination"
				parameterType="com.team2.finalproject.dto.pagination.PageRequestDto" 
				resultType="com.team2.finalproject.dto.product.ProductDto">
			SELECT product_code, category_code, name, content, price, stock, rdate 
			FROM (  
					SELECT product_code, category_code, name, content, price, stock, rdate ,rownum rn
			        FROM (
			        		SELECT product_code, category_code, name, content, price, stock, rdate 
							FROM product
							<trim prefix="WHERE" prefixOverrides="AND |OR">
								<if test="query != null and query !=''">
								 	AND content LIKE '%'||#{query}||'%'
								</if>
							</trim>
	        		)
	        		<![CDATA[
			        WHERE rownum <= #{pageRequest.pageNum} * #{pageRequest.amount}
			        ]]>
	    	)
	    	<![CDATA[
			WHERE rn > (#{pageRequest.pageNum} - 1) *  #{pageRequest.amount}
			]]>
		</select>
 </mapper>